DoITest PowerShell Script=======## Description:### Overview:This script, written for PowerShell, was created to log onto the Drug Court testing [website](https://doi.testday.com),and send the user a text message telling them whether or not they test, along with other relevant information. The scriptcan be set up on a Windows computer to run at a certain time every day. I wrote this for myself after failing, more thanonce, to call the testing number within the specified times. It's easy to get preoccupied at work or with your family andforget all about it.**Disclaimer - This should _not_ be relied on to tell you whether you test on not**, it's more like a small insurancemeasure, but one with a lot of moving parts that have to work together. Some of the things that could happen to prevent the script from executing:  * You could lose power. * You could lose your internet. * The testing web site could go down. * Your computer could go kaput._It is ultimately **your** responsiblity to check in with the testing system every day, either through the[website](https://doi.testday.com), or the phone number._That being said, it is pretty cool getting a text every morning telling you whether you test or not; at least Ithink so.---------------------------------### How it Works:In order to get this up and running, you'll need to set up some tools, all of which come with Windows 10. I'mnot sure about previous versions of Windows, but I'd bet it can be done.The program which executes the script we're using, Windows PowerShell, is a tool designed for system administrators.It's built on top of the .NET Framework and gives us a lot of control within the Windows environment.One of the things we can control with it is the Internet Explorer browser.The first thing the script does is create a new Internet Explorer object, which runs in the background. Then, itnavigates to the testing [website](https://doi.testday.com), and waits for it to load. Once the page is loaded, itfinds the input fields for the pin number and password, fills them in, then clicks the 'Submit' button.Once the next page loads, the script 'scrapes' the <abbr title="Hypertext Markup Language">HTML</abbr> code , pullingout the relevant information we need. It takes the text directly from the page and uses it to build a message we can then send. This message is sent via <abbr title="Simple Mail Transfer Protocol">SMTP</abbr>, through our Gmail account, to anemail-to-<abbr title="Short Message Service">SMS</abbr> server provided by our wireless carrier. This server converts the emailto <abbr title="Short Message Service">SMS</abbr> format and sends it on to our phone. We can even have the message sentto multiple phones with different carriers.The script also makes an entry to a log file every time it's run, so you can go back and see what happened if there's everan issue.To get the script to run at the same time every day we'll use another tool built into Windows, called Task Scheduler.-----------------------------------## Installation:### Configuring the Script:First, save **doitest.ps1** and **logger.ps1** to a folder on your computer;  **C:\Scripts\\**, for example.The next thing we need to do is enter our information into the script. Right-click on **doitest.sp1**, and select**Open With** -> **Notepad**, or a similar text editor. I recommend the built-in**Windows PowerShell <abbr title="Integrated Scripting Environment">ISE</abbr>**, or a programcalled [Notepad++](http://downloads.tomsguide.com/Notepad-,0301-833.html).  Change the following variables in the **Configuration** section at the top of the script:`$timeoutMillis = 20000` Leave this alone unless the page is taking longer than 20 seconds to load for some reason.`$pin = '1590'` This pin is the same for all participants, you can get it from your Coordinator.`$id = '01201970'` This is your unique ID.  Should be the same as the one you enter on the testing hotline.`$emailAddr = 'yourusername@gmail.com'` Change this to your Gmail address.  The script is set up for Gmail, so if you usea different email service, you'll have to set up a throw-away Gmail account, or modify the script to use your particular<abbr title="Simple Mail Transfer Protocol">SMTP</abbr> server. I won't get into how to do that, but a quick Google search andyou should be able to figure it out. For what it's worth, I tried this with Yahoo! and wasn't able to get it to work.  **It's very important to set your account up to allow less secure applications to sign in.**To do this, first log in to your account at Gmail.com, then open another tab and go to the [less secure apps setting](https://myaccount.google.com/lesssecureapps) and click to turn it on.`$password = 'gmailpassword'` Pretty self-explanatory, but then most of this probably is for a lot of you.```$phoneNums = @(	[PSCustomObject]@{ number = '5071234567'; carrier = 'Verizon Wireless'; }	[PSCustomObject]@{ number = '5072345678'; carrier = 'AT&T'; })```	This one's a little trickier.  It's an array of hash-tables. The important thing to know is each line that starts with`[PSCustomObject]` is another phone to send a text to. So if you only need a message sent to your phone, just add a `#`to the beginning of the second line to 'comment it out' so it looks like this:  `#[PSCustomObject]@{ number = '5072345678'; carrier = 'AT&T'; }`  Otherwise, if you want a message sent to more than two phones, copy this line and paste another below it. The numbers must beten digits, and the carrier can be one of the following: Alltel, AT&T, Boost Mobile, Cricket Wireless, MetroPCS, Google Fi,Republic Wireless, Sprint, T-Mobile, U.S. Cellular, Verizon Wireless, or Virgin Mobile. If you specify the wrong carrier,your messages may not go through.Once you have the script updated with your own information, and your email account all set up, it's time to run a test! 	----------------------------------------------------### Testing the Script:Before running the script for the first time, under the **Load Page** section, you may want to find the following line:  `#$ie.visible = $true # Uncomment to make Internet Explorer window visible`Remove the `#` at the front of this line to make the Internet Explorer instance visible so we can watch what the scriptis doing. You can later comment this line back out once we get everything working right.  **Save** the script from your text editor or <abbr title="Integrated Scripting Environment">ISE</abbr>, and move on to the next step.To open PowerShell and allow scripts: 1. Left-click on the Windows icon, and start typing **PowerShell**. 2. Right-click the top-result and click the **Run as Administrator** option. 3. Type the following command to set the Execution Policy of your computer to allow scripts to run and press **Enter**:   `Set-ExecutionPolicy RemoteSigned` 4. Type **A** and press **Enter**.   _NOTE: You only have to do this once. If you ever want to set it back, type:   `Set-ExecutionPolicy Restricted`_To run our script: 1. Type the following and press **Enter**:   `cd C:\Scripts`   If you saved the files to a different directory than **C:\Scripts**, then change this line accordingly. 2. Type the following to run the script and press **Enter**:   `.\doitest.ps1`If we've done everything right, we should see our script executing with no errors displayed between **(SCRIPT STARTED)**and **(SCRIPT FINISHED)**.  If there are any, **close** the PowerShell window and go back through the previous steps to make sureall the **Configuration** settings have been updated correctly, making sure to **save** the file afterward.Once we've got the script executing successfully, it's time to move on to the next step!-------------------------------------------------### Automating Script Execution: Windows Task Scheduler can help you automatically launch a program or PowerShell script at a certain time or when certain  conditions are met.  We'll be setting up a new task to run our script at the same time every day. To create our task:   1. Left-click on the Windows icon, then start typing **Task Scheduler**. 2. Click on **Task Scheduler**. 3. Under **Actions**, click on **Create Task...**   In the **General** tab: 1. Give the task a name such as **Windows Powershell Testing Script** and write a short description. 2. Click the **Run whether user is logged on or not** radio button.    In the **Triggers** tab: 1. Click the **New...** button. 2. Under **Begin the task:**, select **On a schedule**. 3. Under **Settings**, select **Daily**, and enter the time you'd like it to run. 4. Click **OK**. In the **Actions** tab: 1. Click the **New...** button. 2. Under **Action**, select **Start a program**. 3. In the box labeled **Program/script:**, type **PowerShell**. 4. In the box labeled **Add arguments:**, type **C:\Scripts\doitest.ps1** _(if this is the directory you're using.)_ 5. In the box labeled **Start in:**, type **C:\Scripts\\** _(again, if this is your directory.)_   _NOTE: It's important to enter a **Start in** direcory, since our script needs access to the **logger.ps1** script._  In the **Conditions** tab: 1. Check the box labeled **Wake the computer to run this task**.  Click **OK** and enter your **User name** and the **System Password**. _(this should be the password you enter to log on to your computer)_  _NOTE: If you need to go back and edit this task, you'll need to enter your **User name** in the format **HOSTNAME/USERNAME**when prompted._  _If you are unsure what this is, you can open a **command prompt** (Windows icon, type **cmd**), type `hostname` and hit **Enter**._ ---------------------------------------------------Good luck! May you never miss another call-in again!-KD"# DoITest-PowerShell-Script" 
